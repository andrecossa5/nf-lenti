// base.config

// includeConfig 'pipeline.info.config'


//


// Profiles, to combine
profiles {

  docker {

    conda.enabled = false
    docker.enabled = true
    singularity.enabled = false

    process {
      withLabel: 'scLT' {
        container = 'noebll/nf_sclt_sklearn:1.2'
      }
      withLabel: 'MiTo' {
        container = 'acox1/mi_to:1.3'
      }
      withLabel: 'phylo' {
        container = 'noebll/nf_sclt_sklearn:1.2'
      }
    }

  }

  conda {

    conda.enabled = true
    docker.enabled = false
    singularity.enabled = false

    process {
      // withLabel: 'scLT' {
      //   conda.envPath = '<...>/scLT_env'    // Custom
      // }
      // withLabel: 'MiTo' {
      //   conda.envPath = '<...>/MiTo_env'    // Custom
      // }
      // withLabel: 'phylo' {
      //   conda.envPath = '<...>/r_phylo_env' // Custom
      // }
    }

  }

  singularity {

    conda.enabled = false
    docker.enabled = false
    singularity.enabled = true

    process {
      withLabel: 'scLT' {
        container = 'noebll/nf_sclt_sklearn:1.2'
      }
      withLabel: 'MiTo' {
        container = 'acox1/mi_to:1.3'
      }
      withLabel: 'phylo' {
        container = 'noebll/nf_sclt_sklearn:1.2'
      }
    }

  }

  // Global executor profile
  local {
    process.executor = 'local'
  }

}


//


// Processes
process {

  //


  // Common
  withName: MERGE_R1 {
    cpus = 4
    memory = { 1.GB * task.attempt }
  }
  withName: MERGE_R2 {
    cpus = 4
    memory = { 1.GB * task.attempt }
  }
  withName: SOLO {
    cpus = 6 
    memory = { 60.GB * task.attempt }
  }
  withName: EXTRACT_FASTA {
    cpus = 1
    memory = 1.GB
  }
  withName: FILTER_BAM_CB {
    cpus = 1
    memory = 4.GB
  }
  withName: SPLIT_BARCODES {
    cpus = 1 
    memory = { 2.GB * task.attempt }
  }
  withName: SPLIT_BAM {
    cpus = 5
    memory = { 5.GB * task.attempt }
  }


  //


  // Bulk
  withName: SEARCH_PATTERNS {
    cpus = 1
    memory = '1G'
  }
  withName: EXTRACT_GBC {
    cpus = 1
    memory = '1G'
  }
  withName: CORRECT_AND_COUNT {
    cpus = 1
    memory = { 10.GB * task.attempt }
  } 
  withName: PLOT_QC_BULK {
    cpus = 1
    memory = '1G'
  } 
  withName: generate_run_summary_bulk {
    cpus = 1
    memory = '2G'
  }
  withName: publish_bulk {
    cpus = 1
    memory = '2G'
  }
  withName: collapse_output {
    cpus = 1
    memory = { 20.GB * task.attempt }
  }


  //


  // sc_gbc
  withName: CONSENSUS_LENTI {
    cpus = 1
    memory = { 500.MB * task.attempt }
  }
  withName: COLLAPSE_TSV {
    cpus = 1
    memory = { 5.GB * task.attempt }
  }
  withName: CELL_ASSIGNMENT {
    cpus = 1
    memory = 5.GB
  }
  withName: generate_run_summary_sc {
    cpus = 1
    memory = { 1.GB * task.attempt }
  }
  withName: publish_sc_gbc {
    cpus = 1
    memory = { 1.GB * task.attempt }
  }  
  withName: collapse_output_sc {
    cpus = 1
    memory = { 1.GB * task.attempt }
  }  

}

// Tracing
trace {
  enabled = true
  file = "trace.txt"
  overwrite = true
}

// Tracing
//  tower {
//    accessToken = 
//    endpoint= 
//    enabled = true
//    workspaceId = 
//  }


//
